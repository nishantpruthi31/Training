{"cells":[{"cell_type":"code","source":["%%capture\n","\n","!apt-get update\n","!apt-get install -y openjdk-8-jdk-headless -qq\n","!apt-get install maven -qq\n","\n","!curl -L \"https://archive.apache.org/dist/spark/spark-2.4.5/spark-2.4.5-bin-hadoop2.7.tgz\" > spark-2.4.5-bin-hadoop2.7.tgz\n","!tar -xvf spark-2.4.5-bin-hadoop2.7.tgz\n","!pip install -q findspark\n","!pip install pyspark py4j\n","from pyspark.sql import SparkSession\n","from pyspark.sql.functions import when\n","from pyspark.sql import functions\n","from pyspark.sql.types import IntegerType\n","from pyspark.sql.functions import col\n","#from pyspark.sql.Column import isNull\n","from pyspark.sql.functions import lit\n","spark = SparkSession.builder.master(\"local[*]\").config(\"spark.driver.memory\", \"16g\").getOrCreate()"],"metadata":{"id":"VgLhn5ATVIKk","executionInfo":{"status":"ok","timestamp":1704101775889,"user_tz":-330,"elapsed":36711,"user":{"displayName":"Nishant Pruthi","userId":"05492412063404871418"}}},"execution_count":3,"outputs":[]},{"cell_type":"code","source":["# Average rating of each movie from csv file\n"],"metadata":{"id":"WrzX_u_eLz93","executionInfo":{"status":"ok","timestamp":1704101839030,"user_tz":-330,"elapsed":414,"user":{"displayName":"Nishant Pruthi","userId":"05492412063404871418"}}},"execution_count":5,"outputs":[]},{"cell_type":"code","source":["\n","from pyspark import SparkConf, SparkContext\n","conf = SparkConf().setAppName(\"Read File\")\n","sc = SparkContext.getOrCreate(conf=conf)   # we provide configuration\n"],"metadata":{"id":"8zB0OqJqUhAR","executionInfo":{"status":"ok","timestamp":1704101775890,"user_tz":-330,"elapsed":12,"user":{"displayName":"Nishant Pruthi","userId":"05492412063404871418"}}},"execution_count":4,"outputs":[]},{"cell_type":"code","source":["\n","rdd = sc.textFile('movie_ratings.csv')\n","rdd.collect()\n"],"metadata":{"id":"mFSA-Hh8WznA","executionInfo":{"status":"ok","timestamp":1704107077884,"user_tz":-330,"elapsed":460,"user":{"displayName":"Nishant Pruthi","userId":"05492412063404871418"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"815cc7d1-fa94-4fb5-9e73-21e09698b3f3"},"execution_count":32,"outputs":[{"output_type":"execute_result","data":{"text/plain":["['The Shawshank Redemption,3',\n"," 'The Matrix,5',\n"," '12 Angry Men,3',\n"," '12 Angry Men,4',\n"," 'The Matrix,5',\n"," 'Pulp Fiction,4',\n"," 'The Godfather,5',\n"," 'The Shawshank Redemption,2',\n"," 'Pulp Fiction,4',\n"," 'The Godfather,5',\n"," '12 Angry Men,2',\n"," 'The Godfather,3',\n"," 'Pulp Fiction,4',\n"," '12 Angry Men,1',\n"," 'The Shawshank Redemption,2',\n"," '12 Angry Men,1',\n"," 'The Shawshank Redemption,5',\n"," 'Pulp Fiction,5',\n"," 'Pulp Fiction,2',\n"," 'The Matrix,4']"]},"metadata":{},"execution_count":32}]},{"cell_type":"code","source":["x='Hi there,2'\n","x.split(',')\n","# for creating a tuple we can do\n","(x.split(',')[0],x.split(',')[1])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"yxpigYFGgcUb","executionInfo":{"status":"ok","timestamp":1704107327391,"user_tz":-330,"elapsed":526,"user":{"displayName":"Nishant Pruthi","userId":"05492412063404871418"}},"outputId":"43602552-3f4f-4faf-ff24-10930346df0f"},"execution_count":35,"outputs":[{"output_type":"execute_result","data":{"text/plain":["('Hi there', '2')"]},"metadata":{},"execution_count":35}]},{"cell_type":"code","source":["rdd2=rdd.map(lambda x:(x.split(',')[0],  (int(x.split(',')[1]),1)))\n","rdd2.collect()\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Uq1KRjNHlbNc","executionInfo":{"status":"ok","timestamp":1704107838876,"user_tz":-330,"elapsed":1140,"user":{"displayName":"Nishant Pruthi","userId":"05492412063404871418"}},"outputId":"100ee486-70a9-4246-9a91-09eef7a32e18"},"execution_count":38,"outputs":[{"output_type":"execute_result","data":{"text/plain":["[('The Shawshank Redemption', (3, 1)),\n"," ('The Matrix', (5, 1)),\n"," ('12 Angry Men', (3, 1)),\n"," ('12 Angry Men', (4, 1)),\n"," ('The Matrix', (5, 1)),\n"," ('Pulp Fiction', (4, 1)),\n"," ('The Godfather', (5, 1)),\n"," ('The Shawshank Redemption', (2, 1)),\n"," ('Pulp Fiction', (4, 1)),\n"," ('The Godfather', (5, 1)),\n"," ('12 Angry Men', (2, 1)),\n"," ('The Godfather', (3, 1)),\n"," ('Pulp Fiction', (4, 1)),\n"," ('12 Angry Men', (1, 1)),\n"," ('The Shawshank Redemption', (2, 1)),\n"," ('12 Angry Men', (1, 1)),\n"," ('The Shawshank Redemption', (5, 1)),\n"," ('Pulp Fiction', (5, 1)),\n"," ('Pulp Fiction', (2, 1)),\n"," ('The Matrix', (4, 1))]"]},"metadata":{},"execution_count":38}]},{"cell_type":"code","source":[],"metadata":{"id":"renSK8t-mbzx","executionInfo":{"status":"ok","timestamp":1704105579213,"user_tz":-330,"elapsed":2984,"user":{"displayName":"Nishant Pruthi","userId":"05492412063404871418"}}},"execution_count":28,"outputs":[]},{"cell_type":"code","source":["# lambda x,y (1,2),(2,3) = x[0]+y[0]\n","\n","rdd3=rdd2.reduceByKey(lambda x,y: (x[0]+y[0],x[1]+y[1]))\n","rdd3.collect()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"IqxWvQKem0df","executionInfo":{"status":"ok","timestamp":1704108150329,"user_tz":-330,"elapsed":1084,"user":{"displayName":"Nishant Pruthi","userId":"05492412063404871418"}},"outputId":"8412fa8d-85b3-4d8a-dbf1-94522193912a"},"execution_count":40,"outputs":[{"output_type":"execute_result","data":{"text/plain":["[('The Shawshank Redemption', (12, 4)),\n"," ('12 Angry Men', (11, 5)),\n"," ('The Godfather', (13, 3)),\n"," ('The Matrix', (14, 3)),\n"," ('Pulp Fiction', (19, 5))]"]},"metadata":{},"execution_count":40}]},{"cell_type":"code","source":["rdd4=rdd3.map(lambda x: (x[0],round(x[1][0]/x[1][1])))\n","rdd4.collect()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"S2xjnLXqwsb-","executionInfo":{"status":"ok","timestamp":1704108333871,"user_tz":-330,"elapsed":637,"user":{"displayName":"Nishant Pruthi","userId":"05492412063404871418"}},"outputId":"98358286-1436-47b3-c4ac-6e5f3441a8d0"},"execution_count":43,"outputs":[{"output_type":"execute_result","data":{"text/plain":["[('The Shawshank Redemption', 3),\n"," ('12 Angry Men', 2),\n"," ('The Godfather', 4),\n"," ('The Matrix', 5),\n"," ('Pulp Fiction', 4)]"]},"metadata":{},"execution_count":43}]}],"metadata":{"colab":{"provenance":[{"file_id":"11YM-lleSvtN7VXzuep2XS63Vi7Wta6I6","timestamp":1704108353657},{"file_id":"1yaR5AnPIUKlGbxaBCFaqGOibqyzKSsaE","timestamp":1703061654276},{"file_id":"/v2/external/notebooks/intro.ipynb","timestamp":1703060626608}]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}